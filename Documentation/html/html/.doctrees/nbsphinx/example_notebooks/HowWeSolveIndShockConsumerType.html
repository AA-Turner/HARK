

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How we solve a model defined by the IndShockConsumerType class &mdash; HARK latest documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> HARK
          

          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quick-start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../contributing/CONTRIBUTING.html">Contributing to Econ-ARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../CHANGELOG.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_notebooks/Gentle-Intro-To-HARK.html">A Gentle Introduction to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_notebooks/PerfForesightConsumerType.html">PerfForesightConsumerType: Perfect foresight consumption-saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_notebooks/IndShockConsumerType.html">IndShockConsumerType Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_notebooks/KinkedRconsumerType.html">KinkedRconsumerType: Consumption-saving model with idiosyncratic income shocks and different interest rates on borrowing and saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_notebooks/GenIncProcessModel.html">Permanent versus Persistent Income Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_notebooks/LifecycleModel.html">The Distribution of Assets By Age</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_notebooks/HowWeSolveIndShockConsumerType.html">How we solve a model defined by the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../example_notebooks/Journey_1_PhD.html">Journey 1: 1st year PhD student</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">HARK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>How we solve a model defined by the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> class</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/html/.doctrees/nbsphinx/example_notebooks/HowWeSolveIndShockConsumerType.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="How-we-solve-a-model-defined-by-the-IndShockConsumerType-class">
<h1>How we solve a model defined by the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> class<a class="headerlink" href="#How-we-solve-a-model-defined-by-the-IndShockConsumerType-class" title="Permalink to this headline">¶</a></h1>
<p>The IndShockConsumerType reprents the work-horse consumption savings model with temporary and permanent shocks to income, finite or infinite horizons, CRRA utility and more. In this DemARK we take you through the steps involved in solving one period of such a model. The inheritance chains can be a little long, so figuring out where all the parameters and methods come from can be a bit confusing. Hence this map! The intention is to make it easier to know how to inheret from IndShockConsumerType
in the sense that you know where to look for specific solver logic, but also so you know can figure out which methods to overwrite or supplement in your own <code class="docutils literal notranslate"><span class="pre">AgentType</span></code> and solver! ## The <code class="docutils literal notranslate"><span class="pre">solveConsIndShock</span></code> function In HARK, a period’s problem is always solved by the callable (function or callable object instance) stored in the field <code class="docutils literal notranslate"><span class="pre">solve_one_period</span></code>. In the case of <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code>, this function is called <code class="docutils literal notranslate"><span class="pre">solveConsIndShock</span></code>. The function accepts a number of arguments, that
it uses to construct an instance of either a <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> or a <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code>. These solvers both have the methods <code class="docutils literal notranslate"><span class="pre">prepare_to_solve</span></code> and <code class="docutils literal notranslate"><span class="pre">solve</span></code>, that we will have a closer look at in this notebook. This means, that the logic of <code class="docutils literal notranslate"><span class="pre">solveConsIndShock</span></code> is basically:</p>
<ol class="arabic simple">
<li><p>Check if cubic interpolation (<code class="docutils literal notranslate"><span class="pre">CubicBool</span></code>) or construction of the value function interpolant (<code class="docutils literal notranslate"><span class="pre">vFuncBool</span></code>) are requested. Construct an instance of <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> if neither are requested, else construct a <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code>. Call this <code class="docutils literal notranslate"><span class="pre">solver</span></code>.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">solver.prepare_to_solve()</span></code></p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">solver.solve()</span></code> and return the output as the current solution.</p></li>
</ol>
<div class="section" id="Two-types-of-solvers">
<h2>Two types of solvers<a class="headerlink" href="#Two-types-of-solvers" title="Permalink to this headline">¶</a></h2>
<p>As mentioned above, <code class="docutils literal notranslate"><span class="pre">solve_one_period</span></code> will construct an instance of the class <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code>or <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code>. The main difference is whether it uses cubic interpolation or if it explicitly constructs a value function approximation. The choice and construction of a solver instance is bullet 1) from above.</p>
<div class="section" id="What-happens-in-upon-construction">
<h3>What happens in upon construction<a class="headerlink" href="#What-happens-in-upon-construction" title="Permalink to this headline">¶</a></h3>
<p>Neither of the two solvers have their own <code class="docutils literal notranslate"><span class="pre">__init__</span></code>. <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> that in turn inherits from <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code>. <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code>, which itself is just an <code class="docutils literal notranslate"><span class="pre">Object</span></code>, so we get the inheritance structure</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code> <span class="math notranslate nohighlight">\(\leftarrow\)</span> <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code> <span class="math notranslate nohighlight">\(\leftarrow\)</span> <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> <span class="math notranslate nohighlight">\(\leftarrow\)</span> <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code></p></li>
</ul>
<p>When one of the two classes in the end of the inheritance chain is called, it will call <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup.__init__(args...)</span></code>. This takes a whole list of fixed inputs that then gets assigned to the object through a</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ConsIndShockSetup.assign_parameters(solution_next,IncomeDstn,LivPrb,DiscFac,CRRA,Rfree,PermGroFac,BoroCnstArt,aXtraGrid,vFuncBool,CubicBool)
</pre></div>
</div>
<p>call, that then calls</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ConsPerfForesightSolver.assign_parameters(self,solution_next,DiscFac,LivPrb,CRRA,Rfree,PermGroFac)
</pre></div>
</div>
<p>We’re getting kind of detailed here, but it is simply to help us understand the inheritance structure. The methods are quite straight forward, and simply assign the list of variables to self. The ones that do not get assigned by the <code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code> method gets assign by the <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code> method instead.</p>
<p>After all the input parameters are set, we update the utility function definitions. Remember, that we restrict ourselves to CRRA utility functions, and these are parameterized with the scalar we call <code class="docutils literal notranslate"><span class="pre">CRRA</span></code> in HARK. We use the two-argument CRRA utility (and derivatives, inverses, etc) from <code class="docutils literal notranslate"><span class="pre">HARK.utilities</span></code>, so we need to create a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> (an anonymous function) according to the fixed <code class="docutils literal notranslate"><span class="pre">CRRA</span></code> we have chosen. This gets done through a call to</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ConsIndShockSetup.defUtilityFuncs()
</pre></div>
</div>
<p>that itself calls</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ConsPerfForesightSolver.defUtilityFuncs()
</pre></div>
</div>
<p>Again, we wish to emphasize the inheritance structure. The method in <code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code> defines the most basic utility functions (utility, its marginal and its marginal marginal), and <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code> adds additional functions (marginal of inverse, inverse of marginal, marginal of inverse of marginal, and optionally inverse if <code class="docutils literal notranslate"><span class="pre">vFuncBool</span></code> is true).</p>
<p>To sum up, the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method lives in <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code>, calls <code class="docutils literal notranslate"><span class="pre">assign_parameters</span></code> and <code class="docutils literal notranslate"><span class="pre">defUtilityFuncs</span></code> from <code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code> and defines its own methods with the same names that adds some methods used to solve the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> using EGM. The main things controlled by the end-user are whether cubic interpolation should be used, <code class="docutils literal notranslate"><span class="pre">CubicBool</span></code>, and if the value function should be explicitly formed, <code class="docutils literal notranslate"><span class="pre">vFuncBool</span></code>. ### Prepare to solve We are now in bullet 2)
from the list above. The <code class="docutils literal notranslate"><span class="pre">prepare_to_solve</span></code> method is all about grabbing relevant information from next period’s solution, calculating some limiting solutions. It comes from <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code> and calls two methods:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup.setAndUpdateValues(self.solution_next,self.IncomeDstn,self.LivPrb,self.DiscFac)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup.defBoroCnst(self.BoroCnstArt)</span></code></p></li>
</ol>
<p>First, we have <code class="docutils literal notranslate"><span class="pre">setAndUpdateValues</span></code>. The main purpose is to grab the relevant vectors that represent the shock distributions, the effective discount factor, and value function (marginal, level, marginal marginal depending on the options). It also calculates some limiting marginal propensities to consume and human wealth levels. Second, we have <code class="docutils literal notranslate"><span class="pre">defBoroCnst</span></code>. As the name indicates, it calculates the natural borrowing constraint, handles artificial borrowing constraints, and defines the
consumption function where the constraint binds (<code class="docutils literal notranslate"><span class="pre">cFuncNowCnst</span></code>).</p>
<p>To sum, <code class="docutils literal notranslate"><span class="pre">prepare_to_solve</span></code> sets up the stochastic environment an borrowing constraints the consumer might face. It also grabs interpolants from “next period”’s solution.</p>
</div>
</div>
<div class="section" id="Solve-it!">
<h2>Solve it!<a class="headerlink" href="#Solve-it!" title="Permalink to this headline">¶</a></h2>
<p>The last method <code class="docutils literal notranslate"><span class="pre">solveConsIndShock</span></code> will call from the <code class="docutils literal notranslate"><span class="pre">solver</span></code> is <code class="docutils literal notranslate"><span class="pre">solve</span></code>. This method essentially has four steps: 1. Pre-processing for EGM: solver.prepare_to_calc_EndOfPrdvP 1. First step of EGM: solver.calc_EndOfPrdvP 1. Second step of EGM: solver.make_basic_solution 1. Add MPC and human wealth: solver.add_MPC_and_human_wealth</p>
<div class="section" id="Pre-processing-for-EGM-prepare_to_calc_EndOfPrdvP">
<h3>Pre-processing for EGM <code class="docutils literal notranslate"><span class="pre">prepare_to_calc_EndOfPrdvP</span></code><a class="headerlink" href="#Pre-processing-for-EGM-prepare_to_calc_EndOfPrdvP" title="Permalink to this headline">¶</a></h3>
<p>Find relevant values of end-of-period asset values (according to <code class="docutils literal notranslate"><span class="pre">aXtraGrid</span></code> and natural borrowing constraint) and next period values implied by current period end-of-period assets and stochastic elements. The method stores the following in <code class="docutils literal notranslate"><span class="pre">self</span></code>:</p>
<ol class="arabic simple">
<li><p>values of permanent shocks in <code class="docutils literal notranslate"><span class="pre">PermShkVals_temp</span></code></p></li>
<li><p>shock probabilities in <code class="docutils literal notranslate"><span class="pre">ShkPrbs_temp</span></code></p></li>
<li><p>next period resources in <code class="docutils literal notranslate"><span class="pre">mNrmNext</span></code></p></li>
<li><p>current grid of end-of-period assets in <code class="docutils literal notranslate"><span class="pre">aNrmNow</span></code></p></li>
</ol>
<p>The method also returns <code class="docutils literal notranslate"><span class="pre">aNrmNow</span></code>. The definition is in <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> and is not overwritten in <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code>.</p>
</div>
<div class="section" id="First-step-of-EGM-calc_EndOfPrdvP">
<h3>First step of EGM <code class="docutils literal notranslate"><span class="pre">calc_EndOfPrdvP</span></code><a class="headerlink" href="#First-step-of-EGM-calc_EndOfPrdvP" title="Permalink to this headline">¶</a></h3>
<p>Find the marginal value of having some level of end-of-period assets today. End-of-period assets as well as stochastics imply next-period resources at the beginning of the period, calculated above. Return the result as <code class="docutils literal notranslate"><span class="pre">EndOfPrdvP</span></code>.</p>
</div>
<div class="section" id="Second-step-of-EGM-make_basic_solution">
<h3>Second step of EGM <code class="docutils literal notranslate"><span class="pre">make_basic_solution</span></code><a class="headerlink" href="#Second-step-of-EGM-make_basic_solution" title="Permalink to this headline">¶</a></h3>
<p>Apply inverse marginal utility function to nodes from about to find (m, c) pairs for the new consumption function in <code class="docutils literal notranslate"><span class="pre">get_points_for_interpolation</span></code> and create the interpolants in <code class="docutils literal notranslate"><span class="pre">use_points_for_interpolation</span></code>. The latter constructs the <code class="docutils literal notranslate"><span class="pre">ConsumerSolution</span></code> that contains the current consumption function <code class="docutils literal notranslate"><span class="pre">cFunc</span></code>, the current marginal value function <code class="docutils literal notranslate"><span class="pre">vPfunc</span></code>, and the smallest possible resource level <code class="docutils literal notranslate"><span class="pre">mNrmMinNow</span></code>.</p>
</div>
<div class="section" id="Add-MPC-and-human-wealth-add_MPC_and_human_wealth">
<h3>Add MPC and human wealth <code class="docutils literal notranslate"><span class="pre">add_MPC_and_human_wealth</span></code><a class="headerlink" href="#Add-MPC-and-human-wealth-add_MPC_and_human_wealth" title="Permalink to this headline">¶</a></h3>
<p>Add values calculated in <code class="docutils literal notranslate"><span class="pre">defBoroCnst</span></code> now that we have a solution object to put them in.</p>
</div>
<div class="section" id="Special-to-the-non-Basic-solver">
<h3>Special to the non-Basic solver<a class="headerlink" href="#Special-to-the-non-Basic-solver" title="Permalink to this headline">¶</a></h3>
<p>We are now done, but in the <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code> (non-<code class="docutils literal notranslate"><span class="pre">Basic</span></code>!) solver there are a few extra steps. We add steady state m, and depending on the values of <code class="docutils literal notranslate"><span class="pre">vFuncBool</span></code> and <code class="docutils literal notranslate"><span class="pre">CubicBool</span></code> we also add the value function and the marginal marginal value function.</p>
<div class="section" id="Let’s-try-it-in-action!">
<h4>Let’s try it in action!<a class="headerlink" href="#Let’s-try-it-in-action!" title="Permalink to this headline">¶</a></h4>
<p>First, we define a standard lifecycle model, solve it and then</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">HARK.ConsumptionSaving.ConsIndShockModel</span> <span class="kn">import</span> <span class="n">IndShockConsumerType</span><span class="p">,</span> <span class="n">init_lifecycle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">LifecycleExample</span> <span class="o">=</span> <span class="n">IndShockConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">init_lifecycle</span><span class="p">)</span>
<span class="n">LifecycleExample</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Make this consumer live a sequence of periods exactly once</span>
<span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Let’s have a look at the solution in time period second period. We should then be able to</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">HARK.utilities</span> <span class="kn">import</span> <span class="n">plot_funcs</span>
<span class="n">plot_funcs</span><span class="p">([</span><span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cFunc</span><span class="p">],</span><span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mNrmMin</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/html_.doctrees_nbsphinx_example_notebooks_HowWeSolveIndShockConsumerType_5_0.png" src="../../../../_images/html_.doctrees_nbsphinx_example_notebooks_HowWeSolveIndShockConsumerType_5_0.png" />
</div>
</div>
<p>Let us then create a solver for the first period.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">HARK.ConsumptionSaving.ConsIndShockModel</span> <span class="kn">import</span> <span class="n">ConsIndShockSolverBasic</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">ConsIndShockSolverBasic</span><span class="p">(</span><span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">IncShkDstn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">LivPrb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">DiscFac</span><span class="p">,</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">CRRA</span><span class="p">,</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">Rfree</span><span class="p">,</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">PermGroFac</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">BoroCnstArt</span><span class="p">,</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">aXtraGrid</span><span class="p">,</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">vFuncBool</span><span class="p">,</span>
                                 <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">CubicBool</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">solver</span><span class="o">.</span><span class="n">prepare_to_solve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Many important values are now calculated and stored in solver, such as the effective discount factor, the smallest permanent income shock, and more.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">solver</span><span class="o">.</span><span class="n">DiscFacEff</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9586233599999999
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">solver</span><span class="o">.</span><span class="n">PermShkMinNext</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.6554858756904397
</pre></div></div>
</div>
<p>These values were calculated in <code class="docutils literal notranslate"><span class="pre">setAndUpdateValues</span></code>. In <code class="docutils literal notranslate"><span class="pre">defBoroCnst</span></code> that was also called, several things were calculated, for example the consumption function defined by the borrowing constraint.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_funcs</span><span class="p">([</span><span class="n">solver</span><span class="o">.</span><span class="n">cFuncNowCnst</span><span class="p">],</span><span class="n">solver</span><span class="o">.</span><span class="n">mNrmMinNow</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/html_.doctrees_nbsphinx_example_notebooks_HowWeSolveIndShockConsumerType_13_0.png" src="../../../../_images/html_.doctrees_nbsphinx_example_notebooks_HowWeSolveIndShockConsumerType_13_0.png" />
</div>
</div>
<p>Then, we set up all the grids, grabs the discrete shock distributions, and state grids in <code class="docutils literal notranslate"><span class="pre">prepare_to_calc_EndOfPrdvP</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">solver</span><span class="o">.</span><span class="n">prepare_to_calc_EndOfPrdvP</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([-1.97928710e-01, -1.78757337e-01, -1.58464113e-01, -1.36959776e-01,
       -1.14146021e-01, -8.99143874e-02, -6.41449810e-02, -3.67050128e-02,
       -7.44711582e-03,  2.37925970e-02,  5.71967790e-02,  9.29694545e-02,
        1.31339050e-01,  1.72561926e-01,  2.16926520e-01,  2.64758197e-01,
        3.16424968e-01,  3.72344255e-01,  4.32990903e-01,  4.98906718e-01,
        5.70711872e-01,  6.49118576e-01,  7.34947546e-01,  8.29147929e-01,
        9.32821508e-01,  1.04725224e+00,  1.17394250e+00,  1.31465773e+00,
        1.47148180e+00,  1.64688590e+00,  1.84381499e+00,  2.06579663e+00,
        2.31707906e+00,  2.60280747e+00,  2.92925051e+00,  3.30409357e+00,
        3.73682117e+00,  4.23921964e+00,  4.82604335e+00,  5.51590530e+00,
        6.33247875e+00,  7.30613392e+00,  8.47619016e+00,  9.89404831e+00,
        1.16275966e+01,  1.37674827e+01,  1.64361548e+01,  1.98010713e+01])
</pre></div></div>
</div>
<p>Then we calculate the marginal utility of next period’s resources given the stochastic environment and current grids.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">EndOfPrdvP</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">calc_EndOfPrdvP</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Then, we essentially just have to construct the (resource, consumption) pairs by completing the EGM step, and constructing the interpolants by using the knowledge that the limiting solutions are those of the perfect foresight model. This is done with <code class="docutils literal notranslate"><span class="pre">make_basic_solution</span></code> as discussed above.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">solution</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">make_basic_solution</span><span class="p">(</span><span class="n">EndOfPrdvP</span><span class="p">,</span><span class="n">solver</span><span class="o">.</span><span class="n">aNrmNow</span><span class="p">,</span><span class="n">solver</span><span class="o">.</span><span class="n">make_linear_cFunc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Lastly, we add the MPC and human wealth quantities we calculated in the method that prepared the solution of this period.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">solver</span><span class="o">.</span><span class="n">add_MPC_and_human_wealth</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HARK.ConsumptionSaving.ConsIndShockModel.ConsumerSolution at 0x7f2370525af0&gt;
</pre></div></div>
</div>
<p>All that is left is to verify that the solution in <code class="docutils literal notranslate"><span class="pre">solution</span></code> is identical to <code class="docutils literal notranslate"><span class="pre">LifecycleExample.solution[0]</span></code>. We can plot the against each other:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_funcs</span><span class="p">([</span><span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cFunc</span><span class="p">,</span> <span class="n">solution</span><span class="o">.</span><span class="n">cFunc</span><span class="p">],</span><span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mNrmMin</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/html_.doctrees_nbsphinx_example_notebooks_HowWeSolveIndShockConsumerType_23_0.png" src="../../../../_images/html_.doctrees_nbsphinx_example_notebooks_HowWeSolveIndShockConsumerType_23_0.png" />
</div>
</div>
<p>Although, it’s probably even clearer if we just subtract the function values from each other at some grid.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">eval_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cFunc</span><span class="p">(</span><span class="n">eval_grid</span><span class="p">)</span> <span class="o">-</span> <span class="n">solution</span><span class="o">.</span><span class="n">cFunc</span><span class="p">(</span><span class="n">eval_grid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Econ-ARK team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>