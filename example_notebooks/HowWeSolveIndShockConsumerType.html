<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How we solve a model defined by the IndShockConsumerType class &mdash; HARK latest documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="A Lifecycle Model: The Distribution of Assets By Age" href="LifecycleModel.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            HARK
          </a>
              <div class="version">
                latest
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-start.html">Installing HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-start.html#learning-hark">Learning HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-start.html#making-changes-to-hark">Making changes to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-start.html#next-steps">Next steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ARKitecture.html">ARKitecture of Econ-ARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/CONTRIBUTING.html">Contributing to Econ-ARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Gentle-Intro-To-HARK.html">A Gentle Introduction to HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="PerfForesightConsumerType.html">PerfForesightConsumerType: Perfect foresight consumption-saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="IndShockConsumerType.html">IndShockConsumerType Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="KinkedRconsumerType.html">KinkedRconsumerType: Consumption-saving model with idiosyncratic income shocks and different interest rates on borrowing and saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConsPortfolioModel.html">Portfolio Models in HARK</a></li>
<li class="toctree-l1"><a class="reference internal" href="GenIncProcessModel.html">Permanent versus Persistent Income Shocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="LifecycleModel.html">A Lifecycle Model: The Distribution of Assets By Age</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How we solve a model defined by the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> class</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Two-types-of-solvers">Two types of solvers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#What-happens-in-upon-construction">What happens in upon construction</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Solve-it!">Solve it!</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Pre-processing-for-EGM-prepare_to_calc_EndOfPrdvP">Pre-processing for EGM <code class="docutils literal notranslate"><span class="pre">prepare_to_calc_EndOfPrdvP</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#First-step-of-EGM-calc_EndOfPrdvP">First step of EGM <code class="docutils literal notranslate"><span class="pre">calc_EndOfPrdvP</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Second-step-of-EGM-make_basic_solution">Second step of EGM <code class="docutils literal notranslate"><span class="pre">make_basic_solution</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Add-MPC-and-human-wealth-add_MPC_and_human_wealth">Add MPC and human wealth <code class="docutils literal notranslate"><span class="pre">add_MPC_and_human_wealth</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#Special-to-the-non-Basic-solver">Special to the non-Basic solver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Let's-try-it-in-action!">Let’s try it in action!</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HARK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How we solve a model defined by the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> class</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/example_notebooks/HowWeSolveIndShockConsumerType.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="How-we-solve-a-model-defined-by-the-IndShockConsumerType-class">
<h1>How we solve a model defined by the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> class<a class="headerlink" href="#How-we-solve-a-model-defined-by-the-IndShockConsumerType-class" title="Permalink to this heading"></a></h1>
<p>The IndShockConsumerType reprents the work-horse consumption savings model with temporary and permanent shocks to income, finite or infinite horizons, CRRA utility and more. In this DemARK we take you through the steps involved in solving one period of such a model. The inheritance chains can be a little long, so figuring out where all the parameters and methods come from can be a bit confusing. Hence this map! The intention is to make it easier to know how to inheret from IndShockConsumerType
in the sense that you know where to look for specific solver logic, but also so you know can figure out which methods to overwrite or supplement in your own <code class="docutils literal notranslate"><span class="pre">AgentType</span></code> and solver! ## The <code class="docutils literal notranslate"><span class="pre">solveConsIndShock</span></code> function In HARK, a period’s problem is always solved by the callable (function or callable object instance) stored in the field <code class="docutils literal notranslate"><span class="pre">solve_one_period</span></code>. In the case of <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code>, this function is called <code class="docutils literal notranslate"><span class="pre">solveConsIndShock</span></code>. The function accepts a number of arguments, that
it uses to construct an instance of either a <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> or a <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code>. These solvers both have the methods <code class="docutils literal notranslate"><span class="pre">prepare_to_solve</span></code> and <code class="docutils literal notranslate"><span class="pre">solve</span></code>, that we will have a closer look at in this notebook. This means, that the logic of <code class="docutils literal notranslate"><span class="pre">solveConsIndShock</span></code> is basically:</p>
<ol class="arabic simple">
<li><p>Check if cubic interpolation (<code class="docutils literal notranslate"><span class="pre">CubicBool</span></code>) or construction of the value function interpolant (<code class="docutils literal notranslate"><span class="pre">vFuncBool</span></code>) are requested. Construct an instance of <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> if neither are requested, else construct a <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code>. Call this <code class="docutils literal notranslate"><span class="pre">solver</span></code>.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">solver.prepare_to_solve()</span></code></p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">solver.solve()</span></code> and return the output as the current solution.</p></li>
</ol>
<section id="Two-types-of-solvers">
<h2>Two types of solvers<a class="headerlink" href="#Two-types-of-solvers" title="Permalink to this heading"></a></h2>
<p>As mentioned above, <code class="docutils literal notranslate"><span class="pre">solve_one_period</span></code> will construct an instance of the class <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code>or <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code>. The main difference is whether it uses cubic interpolation or if it explicitly constructs a value function approximation. The choice and construction of a solver instance is bullet 1) from above.</p>
<section id="What-happens-in-upon-construction">
<h3>What happens in upon construction<a class="headerlink" href="#What-happens-in-upon-construction" title="Permalink to this heading"></a></h3>
<p>Neither of the two solvers have their own <code class="docutils literal notranslate"><span class="pre">__init__</span></code>. <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> that in turn inherits from <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code>. <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code>, which itself is just an <code class="docutils literal notranslate"><span class="pre">Object</span></code>, so we get the inheritance structure</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code> <span class="math notranslate nohighlight">\(\leftarrow\)</span> <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code> <span class="math notranslate nohighlight">\(\leftarrow\)</span> <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> <span class="math notranslate nohighlight">\(\leftarrow\)</span> <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code></p></li>
</ul>
<p>When one of the two classes in the end of the inheritance chain is called, it will call <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup.__init__(args...)</span></code>. This takes a whole list of fixed inputs that then gets assigned to the object through a</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ConsIndShockSetup.assign_parameters(solution_next,IncomeDstn,LivPrb,DiscFac,CRRA,Rfree,PermGroFac,BoroCnstArt,aXtraGrid,vFuncBool,CubicBool)
</pre></div>
</div>
<p>call, that then calls</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ConsPerfForesightSolver.assign_parameters(self,solution_next,DiscFac,LivPrb,CRRA,Rfree,PermGroFac)
</pre></div>
</div>
<p>We’re getting kind of detailed here, but it is simply to help us understand the inheritance structure. The methods are quite straight forward, and simply assign the list of variables to self. The ones that do not get assigned by the <code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code> method gets assign by the <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code> method instead.</p>
<p>After all the input parameters are set, we update the utility function definitions. Remember, that we restrict ourselves to CRRA utility functions, and these are parameterized with the scalar we call <code class="docutils literal notranslate"><span class="pre">CRRA</span></code> in HARK. We use the two-argument CRRA utility (and derivatives, inverses, etc) from <code class="docutils literal notranslate"><span class="pre">HARK.utilities</span></code>, so we need to create a <code class="docutils literal notranslate"><span class="pre">lambda</span></code> (an anonymous function) according to the fixed <code class="docutils literal notranslate"><span class="pre">CRRA</span></code> we have chosen. This gets done through a call to</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ConsIndShockSetup.defUtilityFuncs()
</pre></div>
</div>
<p>that itself calls</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ConsPerfForesightSolver.defUtilityFuncs()
</pre></div>
</div>
<p>Again, we wish to emphasize the inheritance structure. The method in <code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code> defines the most basic utility functions (utility, its marginal and its marginal marginal), and <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code> adds additional functions (marginal of inverse, inverse of marginal, marginal of inverse of marginal, and optionally inverse if <code class="docutils literal notranslate"><span class="pre">vFuncBool</span></code> is true).</p>
<p>To sum up, the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method lives in <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code>, calls <code class="docutils literal notranslate"><span class="pre">assign_parameters</span></code> and <code class="docutils literal notranslate"><span class="pre">defUtilityFuncs</span></code> from <code class="docutils literal notranslate"><span class="pre">ConsPerfForesightSolver</span></code> and defines its own methods with the same names that adds some methods used to solve the <code class="docutils literal notranslate"><span class="pre">IndShockConsumerType</span></code> using EGM. The main things controlled by the end-user are whether cubic interpolation should be used, <code class="docutils literal notranslate"><span class="pre">CubicBool</span></code>, and if the value function should be explicitly formed, <code class="docutils literal notranslate"><span class="pre">vFuncBool</span></code>. ### Prepare to solve We are now in bullet 2)
from the list above. The <code class="docutils literal notranslate"><span class="pre">prepare_to_solve</span></code> method is all about grabbing relevant information from next period’s solution, calculating some limiting solutions. It comes from <code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup</span></code> and calls two methods:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup.setAndUpdateValues(self.solution_next,self.IncomeDstn,self.LivPrb,self.DiscFac)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ConsIndShockSetup.defBoroCnst(self.BoroCnstArt)</span></code></p></li>
</ol>
<p>First, we have <code class="docutils literal notranslate"><span class="pre">setAndUpdateValues</span></code>. The main purpose is to grab the relevant vectors that represent the shock distributions, the effective discount factor, and value function (marginal, level, marginal marginal depending on the options). It also calculates some limiting marginal propensities to consume and human wealth levels. Second, we have <code class="docutils literal notranslate"><span class="pre">defBoroCnst</span></code>. As the name indicates, it calculates the natural borrowing constraint, handles artificial borrowing constraints, and defines the
consumption function where the constraint binds (<code class="docutils literal notranslate"><span class="pre">cFuncNowCnst</span></code>).</p>
<p>To sum, <code class="docutils literal notranslate"><span class="pre">prepare_to_solve</span></code> sets up the stochastic environment an borrowing constraints the consumer might face. It also grabs interpolants from “next period“‘s solution.</p>
</section>
</section>
<section id="Solve-it!">
<h2>Solve it!<a class="headerlink" href="#Solve-it!" title="Permalink to this heading"></a></h2>
<p>The last method <code class="docutils literal notranslate"><span class="pre">solveConsIndShock</span></code> will call from the <code class="docutils literal notranslate"><span class="pre">solver</span></code> is <code class="docutils literal notranslate"><span class="pre">solve</span></code>. This method essentially has four steps: 1. Pre-processing for EGM: solver.prepare_to_calc_EndOfPrdvP 1. First step of EGM: solver.calc_EndOfPrdvP 1. Second step of EGM: solver.make_basic_solution 1. Add MPC and human wealth: solver.add_MPC_and_human_wealth</p>
<section id="Pre-processing-for-EGM-prepare_to_calc_EndOfPrdvP">
<h3>Pre-processing for EGM <code class="docutils literal notranslate"><span class="pre">prepare_to_calc_EndOfPrdvP</span></code><a class="headerlink" href="#Pre-processing-for-EGM-prepare_to_calc_EndOfPrdvP" title="Permalink to this heading"></a></h3>
<p>Find relevant values of end-of-period asset values (according to <code class="docutils literal notranslate"><span class="pre">aXtraGrid</span></code> and natural borrowing constraint) and next period values implied by current period end-of-period assets and stochastic elements. The method stores the following in <code class="docutils literal notranslate"><span class="pre">self</span></code>:</p>
<ol class="arabic simple">
<li><p>values of permanent shocks in <code class="docutils literal notranslate"><span class="pre">PermShkVals_temp</span></code></p></li>
<li><p>shock probabilities in <code class="docutils literal notranslate"><span class="pre">ShkPrbs_temp</span></code></p></li>
<li><p>next period resources in <code class="docutils literal notranslate"><span class="pre">mNrmNext</span></code></p></li>
<li><p>current grid of end-of-period assets in <code class="docutils literal notranslate"><span class="pre">aNrmNow</span></code></p></li>
</ol>
<p>The method also returns <code class="docutils literal notranslate"><span class="pre">aNrmNow</span></code>. The definition is in <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolverBasic</span></code> and is not overwritten in <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code>.</p>
</section>
<section id="First-step-of-EGM-calc_EndOfPrdvP">
<h3>First step of EGM <code class="docutils literal notranslate"><span class="pre">calc_EndOfPrdvP</span></code><a class="headerlink" href="#First-step-of-EGM-calc_EndOfPrdvP" title="Permalink to this heading"></a></h3>
<p>Find the marginal value of having some level of end-of-period assets today. End-of-period assets as well as stochastics imply next-period resources at the beginning of the period, calculated above. Return the result as <code class="docutils literal notranslate"><span class="pre">EndOfPrdvP</span></code>.</p>
</section>
<section id="Second-step-of-EGM-make_basic_solution">
<h3>Second step of EGM <code class="docutils literal notranslate"><span class="pre">make_basic_solution</span></code><a class="headerlink" href="#Second-step-of-EGM-make_basic_solution" title="Permalink to this heading"></a></h3>
<p>Apply inverse marginal utility function to nodes from about to find (m, c) pairs for the new consumption function in <code class="docutils literal notranslate"><span class="pre">get_points_for_interpolation</span></code> and create the interpolants in <code class="docutils literal notranslate"><span class="pre">use_points_for_interpolation</span></code>. The latter constructs the <code class="docutils literal notranslate"><span class="pre">ConsumerSolution</span></code> that contains the current consumption function <code class="docutils literal notranslate"><span class="pre">cFunc</span></code>, the current marginal value function <code class="docutils literal notranslate"><span class="pre">vPfunc</span></code>, and the smallest possible resource level <code class="docutils literal notranslate"><span class="pre">mNrmMinNow</span></code>.</p>
</section>
<section id="Add-MPC-and-human-wealth-add_MPC_and_human_wealth">
<h3>Add MPC and human wealth <code class="docutils literal notranslate"><span class="pre">add_MPC_and_human_wealth</span></code><a class="headerlink" href="#Add-MPC-and-human-wealth-add_MPC_and_human_wealth" title="Permalink to this heading"></a></h3>
<p>Add values calculated in <code class="docutils literal notranslate"><span class="pre">defBoroCnst</span></code> now that we have a solution object to put them in.</p>
</section>
<section id="Special-to-the-non-Basic-solver">
<h3>Special to the non-Basic solver<a class="headerlink" href="#Special-to-the-non-Basic-solver" title="Permalink to this heading"></a></h3>
<p>We are now done, but in the <code class="docutils literal notranslate"><span class="pre">ConsIndShockSolver</span></code> (non-<code class="docutils literal notranslate"><span class="pre">Basic</span></code>!) solver there are a few extra steps. We add steady state m, and depending on the values of <code class="docutils literal notranslate"><span class="pre">vFuncBool</span></code> and <code class="docutils literal notranslate"><span class="pre">CubicBool</span></code> we also add the value function and the marginal marginal value function.</p>
<section id="Let's-try-it-in-action!">
<h4>Let’s try it in action!<a class="headerlink" href="#Let's-try-it-in-action!" title="Permalink to this heading"></a></h4>
<p>First, we define a standard lifecycle model, solve it and then</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">HARK.ConsumptionSaving.ConsIndShockModel</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">IndShockConsumerType</span><span class="p">,</span>
    <span class="n">init_lifecycle</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">LifecycleExample</span> <span class="o">=</span> <span class="n">IndShockConsumerType</span><span class="p">(</span><span class="o">**</span><span class="n">init_lifecycle</span><span class="p">)</span>
<span class="n">LifecycleExample</span><span class="o">.</span><span class="n">cycles</span> <span class="o">=</span> <span class="p">(</span>
    <span class="mi">1</span>  <span class="c1"># Make this consumer live a sequence of periods exactly once</span>
<span class="p">)</span>
<span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Let’s have a look at the solution in time period second period. We should then be able to</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">HARK.utilities</span> <span class="kn">import</span> <span class="n">plot_funcs</span>

<span class="n">plot_funcs</span><span class="p">(</span>
    <span class="p">[</span><span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cFunc</span><span class="p">],</span> <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mNrmMin</span><span class="p">,</span> <span class="mi">10</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_HowWeSolveIndShockConsumerType_5_0.png" src="../_images/example_notebooks_HowWeSolveIndShockConsumerType_5_0.png" />
</div>
</div>
<p>Let us then create a solver for the first period.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">HARK.ConsumptionSaving.ConsIndShockModel</span> <span class="kn">import</span> <span class="n">ConsIndShockSolverBasic</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">ConsIndShockSolverBasic</span><span class="p">(</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">IncShkDstn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">LivPrb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">DiscFac</span><span class="p">,</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">CRRA</span><span class="p">,</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">Rfree</span><span class="p">,</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">PermGroFac</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">BoroCnstArt</span><span class="p">,</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">aXtraGrid</span><span class="p">,</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">vFuncBool</span><span class="p">,</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">CubicBool</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">prepare_to_solve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Many important values are now calculated and stored in solver, such as the effective discount factor, the smallest permanent income shock, and more.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">DiscFacEff</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9586233599999999
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">PermShkMinNext</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.6554858756904405
</pre></div></div>
</div>
<p>These values were calculated in <code class="docutils literal notranslate"><span class="pre">setAndUpdateValues</span></code>. In <code class="docutils literal notranslate"><span class="pre">defBoroCnst</span></code> that was also called, several things were calculated, for example the consumption function defined by the borrowing constraint.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_funcs</span><span class="p">([</span><span class="n">solver</span><span class="o">.</span><span class="n">cFuncNowCnst</span><span class="p">],</span> <span class="n">solver</span><span class="o">.</span><span class="n">mNrmMinNow</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_HowWeSolveIndShockConsumerType_13_0.png" src="../_images/example_notebooks_HowWeSolveIndShockConsumerType_13_0.png" />
</div>
</div>
<p>Then, we set up all the grids, grabs the discrete shock distributions, and state grids in <code class="docutils literal notranslate"><span class="pre">prepare_to_calc_EndOfPrdvP</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">prepare_to_calc_EndOfPrdvP</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([-1.97928710e-01, -1.78757337e-01, -1.58464113e-01, -1.36959776e-01,
       -1.14146021e-01, -8.99143874e-02, -6.41449810e-02, -3.67050128e-02,
       -7.44711582e-03,  2.37925970e-02,  5.71967790e-02,  9.29694545e-02,
        1.31339050e-01,  1.72561926e-01,  2.16926520e-01,  2.64758197e-01,
        3.16424968e-01,  3.72344255e-01,  4.32990903e-01,  4.98906718e-01,
        5.70711872e-01,  6.49118576e-01,  7.34947546e-01,  8.29147929e-01,
        9.32821508e-01,  1.04725224e+00,  1.17394250e+00,  1.31465773e+00,
        1.47148180e+00,  1.64688590e+00,  1.84381499e+00,  2.06579663e+00,
        2.31707906e+00,  2.60280747e+00,  2.92925051e+00,  3.30409357e+00,
        3.73682117e+00,  4.23921964e+00,  4.82604335e+00,  5.51590530e+00,
        6.33247875e+00,  7.30613392e+00,  8.47619016e+00,  9.89404831e+00,
        1.16275966e+01,  1.37674827e+01,  1.64361548e+01,  1.98010713e+01])
</pre></div></div>
</div>
<p>Then we calculate the marginal utility of next period’s resources given the stochastic environment and current grids.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">EndOfPrdvP</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">calc_EndOfPrdvP</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Then, we essentially just have to construct the (resource, consumption) pairs by completing the EGM step, and constructing the interpolants by using the knowledge that the limiting solutions are those of the perfect foresight model. This is done with <code class="docutils literal notranslate"><span class="pre">make_basic_solution</span></code> as discussed above.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solution</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">make_basic_solution</span><span class="p">(</span>
    <span class="n">EndOfPrdvP</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">aNrmNow</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">make_linear_cFunc</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Lastly, we add the MPC and human wealth quantities we calculated in the method that prepared the solution of this period.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solver</span><span class="o">.</span><span class="n">add_MPC_and_human_wealth</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;HARK.ConsumptionSaving.ConsIndShockModel.ConsumerSolution at 0x177c17f1f40&gt;
</pre></div></div>
</div>
<p>All that is left is to verify that the solution in <code class="docutils literal notranslate"><span class="pre">solution</span></code> is identical to <code class="docutils literal notranslate"><span class="pre">LifecycleExample.solution[0]</span></code>. We can plot the against each other:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_funcs</span><span class="p">(</span>
    <span class="p">[</span><span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cFunc</span><span class="p">,</span> <span class="n">solution</span><span class="o">.</span><span class="n">cFunc</span><span class="p">],</span>
    <span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mNrmMin</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/example_notebooks_HowWeSolveIndShockConsumerType_23_0.png" src="../_images/example_notebooks_HowWeSolveIndShockConsumerType_23_0.png" />
</div>
</div>
<p>Although, it’s probably even clearer if we just subtract the function values from each other at some grid.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eval_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">LifecycleExample</span><span class="o">.</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cFunc</span><span class="p">(</span><span class="n">eval_grid</span><span class="p">)</span> <span class="o">-</span> <span class="n">solution</span><span class="o">.</span><span class="n">cFunc</span><span class="p">(</span><span class="n">eval_grid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])
</pre></div></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="LifecycleModel.html" class="btn btn-neutral float-left" title="A Lifecycle Model: The Distribution of Assets By Age" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Econ-ARK team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>